---
output: github_document
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```
# betaC

The goal ofthe r package "betaC" is to provide code for the calculation of beta_C, a metric to quantify the non-random component in beta-diversity. 

## Installation

You can install the development version of betaC from [GitHub](https://github.com/T-Engel/betaC) with:

``` r
devtools::install_github("T-Engel/betaC")
```

Please, also install the package "vegan" from CRAN.

## Example: Beta-diversity of the BCI dataset from vegan

Let's look at the beta_diversity of the BCI dataset that comes with the package vegan.

```{r example}
library(betaC)
library(vegan)
data(BCI)

# Multiplicative beta-diversity 
gamma=specnumber(colSums(BCI))
alpha= mean(specnumber(BCI))
beta_BCI=gamma/alpha
beta_BCI

# beta_C for 50% coverage
beta_C_BCI<-beta_C(BCI,0.5)
beta_C_BCI
```

The samples have a beta-diversity of `round(r beta_BCI,2)` but most of this differention is due to a sampling effect. If we standardize to the number if individuals that corresponds to 50 % coverage at the gamma scale we find that the partition of the non-random component in beta-diversity is only ca `r round(beta_C_BCI,2)`

To illustrate this let's have a look at the rarefaction curves

```{r}
# a function to draw nice rarefaction curves
library(tidyverse)
rarefy_long <- function(x) {
  if(is.matrix(x)==F) x=matrix(x,nrow = 1, byrow =T, dimnames= list("x", names(x)))
    alphas <-
        lapply(row.names(x), function(i)
            return(as.numeric(vegan::rarefy(
                x[i, ], sample = 1:sum(x[i, ])
            )))) %>%
        lapply(function(x)
            return(data.frame(
                S_n = as.numeric(x), N = 1:length(x)
            )))
    names(alphas) <- rownames(x)
    alphas <- alphas %>% plyr::ldply(.id = "Curve")
    alphas$type = "minor"
    mean_alpha <-
        data.frame(
            Curve = "mean_alpha",
            S_n = colMeans(as.matrix(vegan::rarefy(
                x, 1:min(rowSums(x))
            ))),
            N = 1:min(rowSums(x)),
            type = "major"
        )
    gamma <-
        data.frame(
            Curve = "gamma",
            S_n = as.numeric(vegan::rarefy(colSums(x), 1:sum(x))),
            N = 1:sum(x),
            type = "major"
        )
    out = alphas %>% full_join(mean_alpha, by = c("Curve", "S_n", "N",  "type")) %>% full_join(gamma, by = c("Curve", "S_n", "N", "type"))
    
}

dat<-rarefy_long(as.matrix(BCI))

dat %>% filter(type== "major") %>% ggplot(aes(N,S_n, col= Curve))+ geom_line(size=1.5)+ geom_hline(yintercept =  alpha)+
geom_hline(yintercept =  gamma)
```



