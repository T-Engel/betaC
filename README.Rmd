---
output: github_document
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "150%"
)
```
# betaC

The r package "betaC" provides code for the calculation of beta_C, a metric to quantify the non-random component in beta-diversity for a given coverage. 

## Installation

You can install the development version of betaC from [GitHub](https://github.com/T-Engel/betaC) with:

``` r
devtools::install_github("T-Engel/betaC")
```

Please, also install the package "vegan" from CRAN. Furthermore, "tidyverse" is recommended but the main functions will work without it. 

## Example: Beta-diversity of the BCI dataset from vegan

Let's look at the beta_diversity of the BCI dataset that comes with the package vegan.

```{r example}
library(betaC)
library(vegan)
data(BCI)

# Multiplicative beta-diversity 
gamma=specnumber(colSums(BCI))
alpha= mean(specnumber(BCI))
beta_BCI=gamma/alpha
beta_BCI

# beta_C for 50% coverage
beta_C_BCI<-beta_C(BCI,0.5)
beta_C_BCI
```

The samples have a beta-diversity of `r round(beta_BCI,2)` but most of this differention is due to a sampling effect. If we standardize to the number if individuals that corresponds to 50 % coverage at the gamma scale we find that the partition of the non-random component in beta-diversity is only ca `r round(beta_C_BCI,2)`

To illustrate this let's have a look at the rarefaction curves

```{r  message=FALSE, warning=FALSE}
library(tidyverse)

# calculate rarefaction curves
dat<-betaC:::rarefy_long(as.matrix(BCI))

# plot them
dat %>% filter(type== "major") %>% ggplot(aes(N,S_n, col= Curve))+ geom_line(size=1.5)+ geom_hline(yintercept =  alpha)+
geom_hline(yintercept =  gamma)+ geom_vline(xintercept =  invChat(colSums(BCI), 0.5), linetype= "dashed")
```

The horizontal black lines indicate the observed species richness at alpha and gamma scales. The rarefaction curves fall very closely on top of each other indicating that there is not a strong signal of spatial structure. The observed beta-diversity is mostly caused by difference in sample size. Beta_C of 50% is calculated at a sample size of `r round(invChat(colSums(BCI), 0.5))` individuals (dashed vertical line).

## Functions
The main function `beta_C` uses the following  helper functions to jump between sample size and coverage. Both have been adapted from iNEXT.

- `Chat`
- `invChat`

Furthermore, there is a function that helps to determine the target coverage value:

- `C_target`


